Console.WriteLine(new List<List<string>>(){File.ReadAllLines("input.txt").ToList()}.Select(lines => lines.SelectMany((row, irow) => row.Select((col, icol) => (irow, icol, col)))).Select(mat => (mat.ToDictionary(x => (x.irow, x.icol), x => int.Parse(x.col + "")), mat.Max(t => t.irow), mat.Max(t => t.icol))).Select(dict => dict.Item1.Keys.AsParallel().Where(t => dict.Item1[t] == 0).Sum(start => Enumerable.Range(0, (dict.Item2+1)*(dict.Item3+1)).Aggregate(new List<System.Collections.Immutable.ImmutableList<(int,int)>>(){System.Collections.Immutable.ImmutableList.ToImmutableList(new List<(int,int)>(){start})} as IEnumerable<System.Collections.Immutable.ImmutableList<(int,int)>>, (curr, it) => curr.SelectMany(path => new List<System.Collections.Immutable.ImmutableList<(int,int)>>(){path}.Select(path => (path, path.Last())).SelectMany(path => dict.Item1[path.path.Last()] == 9 ? [path.path] : new List<(int,int)>(){(path.Item2.Item1+1, path.Item2.Item2),(path.Item2.Item1, path.Item2.Item2+1),(path.Item2.Item1-1, path.Item2.Item2),(path.Item2.Item1, path.Item2.Item2-1)}.Where(t => !path.path.Any(x => t.Item1 == x.Item1 && t.Item2 == x.Item2) && dict.Item1.ContainsKey(t) && dict.Item1[t] == dict.Item1[path.Item2]+1).Select(candidate => path.path.Add(candidate))))).Where(t => dict.Item1[t.Last()] == 9).Count())).Sum());